<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.61">
<link rel="search" type="application/opensearchdescription+xml" title="WIZnet Document System" href="/opensearch.xml"><title data-react-helmet="true">Pulse Width Modulation(PWM) | WIZnet Document System</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Pulse Width Modulation(PWM) | WIZnet Document System"><meta data-react-helmet="true" name="description" content="Introduction"><meta data-react-helmet="true" property="og:description" content="Introduction"><meta data-react-helmet="true" property="og:url" content="https://doc.wiznet.io/docs/Product/iMCU/W7500/Peripherals-internal/pwm"><link data-react-helmet="true" rel="shortcut icon" href="/img/wizfavicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link data-react-helmet="true" rel="canonical" href="https://doc.wiznet.io/docs/Product/iMCU/W7500/Peripherals-internal/pwm"><link rel="stylesheet" href="/styles.7906f913.css">
<link rel="preload" href="/styles.4e0a1a27.js" as="script">
<link rel="preload" href="/runtime~main.b9c9ab4e.js" as="script">
<link rel="preload" href="/main.47f4e2e1.js" as="script">
<link rel="preload" href="/1.b2e2278b.js" as="script">
<link rel="preload" href="/2.7fd962a2.js" as="script">
<link rel="preload" href="/4716c923.6208fc6d.js" as="script">
<link rel="preload" href="/454.45bb68ed.js" as="script">
<link rel="preload" href="/20ac7829.4a5dfdcd.js" as="script">
<link rel="preload" href="/17896441.fcb68c2a.js" as="script">
<link rel="preload" href="/4a0e3296.d8ca5a85.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/wiznet_logo_110x37.png" alt="My Site Logo"><strong class="navbar__title"></strong></a><a class="navbar__item navbar__link" href="/docs/introduction">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Wiznet/document_framework" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">âŒ˜</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/wiznet_logo_110x37.png" alt="My Site Logo"><strong class="navbar__title"></strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/introduction">Documentation</a></li><li class="menu__list-item"><a href="https://github.com/Wiznet/document_framework" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Pulse Width Modulation(PWM)</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="introduction"></a>Introduction<a aria-hidden="true" tabindex="-1" class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><p>The PWM consists a 8-channel 32-bit Timer/Counter driven by a programmable prescaler. The function of the PWM is based on the basic Timer. Each timer and counter runs independently.</p><p>The PWM can be used to control the width of the pulse, formally the pulse duration, to generate output waveform or to count the counter triggered by external input.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="features"></a>Features<a aria-hidden="true" tabindex="-1" class="hash-link" href="#features" title="Direct link to heading">#</a></h2><ul><li>Counter or Timer operation can use the peripheral clock, external clock source, or one of the capture inputs as the clock source.</li><li>Eight independent 32-bit Timer/Counter driven by a programmable 6 bits prescaler runs as the PWM or standard timer if the PWM mode is not enabled.</li><li>Eight PWM output waveforms.</li><li>Each of Timer/Counter can have different or same clock source.</li><li>Counter or timer operation.</li><li>Eight capture registers that can take the timer value when an external input signal. A capture event can generate an interrupt signal optionally.</li><li>32-bit match register and limit register.</li></ul><p><img src="/img/products/w7500p/peripheral/pwm_block_diagram.jpg" title="Figure 1 PWM block diagram"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="functional-description"></a>Functional description<a aria-hidden="true" tabindex="-1" class="hash-link" href="#functional-description" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="timercounter-control"></a>Timer/Counter control<a aria-hidden="true" tabindex="-1" class="hash-link" href="#timercounter-control" title="Direct link to heading">#</a></h3><p>The PWM has 8 Timer/Counter clocks, which can be divided by a prescaler. Each Timer/Counter runs independently. The Timer/Counter is designed to count cycles of the clocks or external input signal and generate interrupts when specified timer values are occurred based on match register and limit register. The Timer/Counter can count up or down.</p><p>The PWM has match registers and limit registers. The match registers control the duty cycle of PWM output waveform. The limit registers control the period of the PWM output waveform. The Timer/Counter becomes 0 when it reaches value of the limit register. If PDMR(Periodic Mode Register) is set, the Timer/Counter counts repeatedly and if PDMR is reset, the Timer/Counter stops counting.
Match register should be smaller than limit register(LR). If not, match interrupt is not occurred and PWM output waveform is always 1.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="repetition-mode"></a>Repetition mode<a aria-hidden="true" tabindex="-1" class="hash-link" href="#repetition-mode" title="Direct link to heading">#</a></h4><p>The Timer/Counter has two repetition mode: periodic and one-shot mode. In periodic mode, the Timer/Counter recycles and then restarts when the Timer/Counter reaches the value of limit register. The below Figure shows periodic mode timing diagram</p><p><img src="/img/products/w7500p/peripheral/pwm_periodic_mode.jpg" title="Figure 2 Periodic mode"></p><p>In one-shot mode, the Timer/Counter resets to the initial value and then stops when the Timer/Counter reaches the value of limit register. The below Figure shows one-shot mode timing diagram.</p><p><img src="/img/products/w7500p/peripheral/pwm_oneshot_mode.jpg" title="Figure 3 One shot mode"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="counting-mode"></a>Counting mode<a aria-hidden="true" tabindex="-1" class="hash-link" href="#counting-mode" title="Direct link to heading">#</a></h4><p>The Timer/Counter has two counting mode: Up-count and Down-count mode. In up-count mode, the Timer/Counter counts up from 0 to the limit register value and then recycles. If repetition mode is periodic, the Timer/Counter restarts and if repetition mode is one-shot mode, the Timer/Counter stops. The below Figure shows up-count mode timing diagram.</p><p><img src="/img/products/w7500p/peripheral/pwm_upcount_mode.jpg" title="Figure 4 Up count mode"></p><p>In Down-count mode, the Timer/Counter counts from 0xFFFF_FFFF, then recycles. If repetition mode is periodic, the Timer/Counter restarts and if repetition mode is one-shot mode, the Timer/Counter stops. The below Figure shows down-count mode timing diagram.</p><p><img src="/img/products/w7500p/peripheral/pwm_downcount_mode.jpg" title="Figure 5 Down count mode"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="timer-and-counter-mode"></a>Timer and Counter mode<a aria-hidden="true" tabindex="-1" class="hash-link" href="#timer-and-counter-mode" title="Direct link to heading">#</a></h4><p>The Timer/Counter can run in timer mode or counter mode. In timer mode, the Timer/Counter is counted by PWMCLK after Prescale counter is overflowed. If prescale is set by 0, the Timer/Counter counts every PWMCLK period. In counter mode, the Timer/Counter is counted by external input signal. There are three counting method: rising edge, falling edge, and both edge. The counter mode has up-count or down-count mode and also has periodic or one-shot mode. The external input pin and PWM output pin are the same, so PWM output is disabled in counter mode.</p><p>The below Figure is counter mode example with rising edge mode.
![](/img/products/w7500p/peripheral/pwm_counter_mode1.jpg&quot; Figure 6 Counter mode with rising edge&quot;)</p><p>The below Figure is with falling edge mode.
<img src="/img/products/w7500p/peripheral/pwm_counter_mode2.jpg" title="Figure 7 Counter mode with falling edge"></p><p>The below Figure is with both rising and falling edge mode.
<img src="/img/products/w7500p/peripheral/pwm_counter_mode3.jpg" title="Figure 8 Counter mode with rising and falling edge"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="prescaler-description"></a>Prescaler description<a aria-hidden="true" tabindex="-1" class="hash-link" href="#prescaler-description" title="Direct link to heading">#</a></h4><p>The PWM has 6-bit prescale counter(PC) and the prescaler can divide the Timer/Counter clock frequency. Users can control it by Prescale Register(PR).</p><p>The below Figures show some examples of the Timer/Counter timing with prescale register is 2, match register is 2, limit register is 12, timer mode, periodic mode, up-count mode, and no interrupt clear.</p><p>The below Figure shows Timer/Counter timing diagram with match interrupt.</p><p><img src="/img/products/w7500p/peripheral/pwm_timing_diagram1.jpg" title="Figure 9 Timer/Counter timing diagram with match interrupt"></p><p>The below Figure Timer/Counter timing diagram with overflow interrupt.</p><p><img src="/img/products/w7500p/peripheral/pwm_timing_diagram2.jpg" title="Figure 10 Timer/Counter timing diagram with overflow interrupt"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="pwm-mode"></a>PWM mode<a aria-hidden="true" tabindex="-1" class="hash-link" href="#pwm-mode" title="Direct link to heading">#</a></h3><p>Pulse Width Modulation mode generates a waveform with a period determined by the value of limit register and a duty cycle determined by the value of the match register. </p><p>The PWM output becomes always 1 when the Timer/Counter starts to count. Then the PWM output becomes 0 when the Timer/Counter reaches the value of match register. If the Timer/Counter is in periodic mode, the PWM output becomes 1 again when the Timer/Counter reaches the value of limit register. In one-shot mode, the PWM output does not change to 1 but stays 0 and the Timer/Counter stops.</p><p>The PWM mode can be selected independently on each channel(0~7) by PWM output enable and external input enable register. The external input pin and PWM output pin are the same, so external input is disabled in PWM mode.</p><p>The below Figure is an example of the PWM output waveform when the Timer/Counter is reached to the value of match register.</p><p><img src="/img/products/w7500p/peripheral/pwm_timing_diagram2.jpg" title="Figure 11 The PWM output up to match register"></p><p>The below Figure is example of the PWM output waveform when to the Timer/Counter is reached to the value of limit register.</p><p><img src="/img/products/w7500p/peripheral/pwm_timing_diagram2.jpg" title="Figure 12 The PWM output up to limit register"></p><p>If match register is set as 0, the PWM output will be 1 while the Timer/Counter is 0.
If the match register is bigger than the limit register, the PWM output is always 1.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="interrupt"></a>Interrupt<a aria-hidden="true" tabindex="-1" class="hash-link" href="#interrupt" title="Direct link to heading">#</a></h3><p>The PWM has 8-bit interrupt enable register(IER) and each bit of IER corresponds to each interrupt of channel. Each PWM channel has Channel-n Interrupt Enable register(CHn_IER). The CHn_IER includes three types of interrupt: match, overflow, and capture. The match interrupt occurs when the Timer/Counter is reached to value of match register. The overflow interrupt occurs when the Timer/Counter is reached to value of limit register. The capture interrupt occurs when external input is entered for capture.</p><p>If interrupt occurs, corresponded bit of Channel-x interrupt register(CHn_IR) bit is set and PWM channel-n interrupt signal is generated. All CHn_IR is cleared by channel-n interrupt clear register(CHn_ICR) and then PWM channel-n interrupt signal is cleared.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="dead-zone-generation"></a>Dead zone generation<a aria-hidden="true" tabindex="-1" class="hash-link" href="#dead-zone-generation" title="Direct link to heading">#</a></h3><p>Each PWM channel can output two complementary signals with dead zone time and it can be enabled by Channel-n Dead Zone Enable Register(CHn_DZER). Only 4 channels can be enabled because there are 8 PWM output pins. Channel 0 and 1 are a pair, channel 2 and 3 are a pair, channel 4 and 5 are a pair, and channel 6 and 7 are a pair. If users want to use channel-0 dead zone generation, channel-1 should be disabled. If channel 0 and 1 dead zone generation are enabled both, all outputs are 0. In that case, users should choose 1 channel.</p><p>Dead zone time are generated by the value of Channel-n Dead Zone Counter Register(DZCR). The dead zone counter counts up to value of DZCR. During the dead zone time, both complementary signals are both 0. Users have to adjust the signal depending on the devices that are connected to the outputs and their characteristics. If DZCR is bigger than the limit register, main output signal is toggled 0 to1 and then 1 to 0 while 1 PWMCLK and inverted output signal is always 0.</p><p>The below Figure shows two complementary PWM outputs with dead zone time. During dead zone time, both outputs are 0.</p><p><img src="/img/products/w7500p/peripheral/pwm_deadzone.jpg" title="Figure 13 PWM waveform with dead zone time"></p><p>The below Figure shows a more detailed timing with dead zone counter.</p><p><img src="/img/products/w7500p/peripheral/pwm_deadzone_counter.jpg" title="Figure 14 PWM waveform with dead zone counter"></p><p>The dead zone counter and the Timer/Counter starts to count together and PWM output is 0 until dead zone counter is reached to value of dead zone counter register. The PWM output becomes 1 and 0 when the Timer/Counter is reached to value of match register. The inverted PWM output is also 0 until dead zone counter is reached to value of dead zone counter register. Then inverted PWM output becomes 1 after dead zone counter is reached to the value of dead zone counter register.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="capture-event"></a>Capture event<a aria-hidden="true" tabindex="-1" class="hash-link" href="#capture-event" title="Direct link to heading">#</a></h3><p>Each PWM channel can capture its Timer/Counter value when an external input signal changes. Any channel could use any method of rising or falling edges. If capture interrupt is enabled, capture interrupt occurs when the external input signal is toggled. The Timer/Counter value is saved in Channel-n Capture Register(CHn_CR) and the capture register is not overwritten until capture interrupt is cleared. The below Figure shows the capture event timing diagram. There is no interrupt clear, so second capture does not save during second rising edge detection. </p><p><img src="/img/products/w7500p/peripheral/pwm_nointerrupt.jpg" title="Figure 15 Capture event with no interrupt clear"></p><p>The below Figure shows, the capture event timing diagram with interrupt clear. The second capture is saved at the second rising edge detection because there is interrupt clear.</p><p><img src="/img/products/w7500p/peripheral/pwm_interrupt.jpg" title="Figure 16 Capture event with interrupt clear"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="how-to-set-the-pwm"></a>How to set the PWM<a aria-hidden="true" tabindex="-1" class="hash-link" href="#how-to-set-the-pwm" title="Direct link to heading">#</a></h3><p>The below Figure shows the PWM setting flow step by step. </p><p><img src="/img/products/w7500p/peripheral/pwm_flow_chart.jpg" title="Figure 17 The PWM setting flow"></p><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="peripheral_examples"></a>Peripheral_Examples<a aria-hidden="true" tabindex="-1" class="hash-link" href="#peripheral_examples" title="Direct link to heading">#</a></h2><ul><li><a href="/docs/Product/iMCU/W7500/Peripherals-internal/capturemode">CaptureMode example</a></li><li><a href="/docs/Product/iMCU/W7500/Peripherals-internal/countermode">CounterMode example</a></li><li><a href="/docs/Product/iMCU/W7500/Peripherals-internal/deadzonegeneration">DeadZoneGeneration example</a></li><li><a href="/docs/Product/iMCU/W7500/Peripherals-internal/pwmoutput">PWMOutput example</a></li><li><a href="/docs/Product/iMCU/W7500/Peripherals-internal/timermode">TimerMode example</a></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/Wiznet/document_framework/tree/master/docs/Product/iMCU/W7500/Peripherals-internal/pwm.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3klQ"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link">Introduction</a></li><li><a href="#features" class="table-of-contents__link">Features</a></li><li><a href="#functional-description" class="table-of-contents__link">Functional description</a><ul><li><a href="#timercounter-control" class="table-of-contents__link">Timer/Counter control</a></li><li><a href="#pwm-mode" class="table-of-contents__link">PWM mode</a></li><li><a href="#interrupt" class="table-of-contents__link">Interrupt</a></li><li><a href="#dead-zone-generation" class="table-of-contents__link">Dead zone generation</a></li><li><a href="#capture-event" class="table-of-contents__link">Capture event</a></li><li><a href="#how-to-set-the-pwm" class="table-of-contents__link">How to set the PWM</a></li></ul></li><li><a href="#peripheral_examples" class="table-of-contents__link">Peripheral_Examples</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction">Introduction</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://forum.wiznet.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">WIZnet Forum</a></li><li class="footer__item"><a href="http://maker.wiznet.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">WIZnet Maker</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/Wiznet/document_framework" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2020 WIZnet Co., Ltd. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.4e0a1a27.js"></script>
<script src="/runtime~main.b9c9ab4e.js"></script>
<script src="/main.47f4e2e1.js"></script>
<script src="/1.b2e2278b.js"></script>
<script src="/2.7fd962a2.js"></script>
<script src="/4716c923.6208fc6d.js"></script>
<script src="/454.45bb68ed.js"></script>
<script src="/20ac7829.4a5dfdcd.js"></script>
<script src="/17896441.fcb68c2a.js"></script>
<script src="/4a0e3296.d8ca5a85.js"></script>
</body>
</html>