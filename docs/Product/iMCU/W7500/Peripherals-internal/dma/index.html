<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.61">
<link rel="search" type="application/opensearchdescription+xml" title="WIZnet Document System" href="/opensearch.xml"><title data-react-helmet="true">Direct Memory Access(DMA) | WIZnet Document System</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Direct Memory Access(DMA) | WIZnet Document System"><meta data-react-helmet="true" name="description" content="Introduction"><meta data-react-helmet="true" property="og:description" content="Introduction"><meta data-react-helmet="true" property="og:url" content="https://doc.wiznet.io/docs/Product/iMCU/W7500/Peripherals-internal/dma"><link data-react-helmet="true" rel="shortcut icon" href="/img/wizfavicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link data-react-helmet="true" rel="canonical" href="https://doc.wiznet.io/docs/Product/iMCU/W7500/Peripherals-internal/dma"><link rel="stylesheet" href="/styles.dbfb2c5a.css">
<link rel="preload" href="/styles.413cdf69.js" as="script">
<link rel="preload" href="/runtime~main.f54b763e.js" as="script">
<link rel="preload" href="/main.fba6c6f6.js" as="script">
<link rel="preload" href="/1.171ba466.js" as="script">
<link rel="preload" href="/2.b98f2df4.js" as="script">
<link rel="preload" href="/3.18a04464.js" as="script">
<link rel="preload" href="/1be78505.0d1935e2.js" as="script">
<link rel="preload" href="/20ac7829.e3ea8621.js" as="script">
<link rel="preload" href="/17896441.629849c2.js" as="script">
<link rel="preload" href="/b235cbd4.120a16af.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/wiznet_logo_110x37.png" alt="My Site Logo"><strong class="navbar__title"></strong></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Wiznet/document_framework" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">üåû</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">‚åò</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/wiznet_logo_110x37.png" alt="My Site Logo"><strong class="navbar__title"></strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/Wiznet/document_framework" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Direct Memory Access(DMA)</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="introduction"></a>Introduction<a aria-hidden="true" tabindex="-1" class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><p>Direct memory access (DMA) is used in order to provide high-speed data transfer between peripherals and memory as well as memory to memory. Data can be quickly moved by DMA without any CPU actions. This keeps CPU resources free for other operations.</p><p>The DMA controller has up to 6 channels in total, each dedicated to managing memory access requests from one or more peripherals. It has an arbiter for handling the priority between DMA requests. For more details, refer to ‚ÄúPrimeCell¬Æ ŒºDMA Controller (PL230)‚Äù from the Technical Reference Manual</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="features"></a>Features<a aria-hidden="true" tabindex="-1" class="hash-link" href="#features" title="Direct link to heading">#</a></h2><ul><li>6 channels</li><li>Each channel is connected to dedicated hardware DMA requests and software trigger is also supported on each channel.</li><li>Priorities between requests from the DMA channels are software programmable (2 levels consisting of high, default)</li><li>Memory-to-memory transfer (software request only)</li><li>TCP/IP-to-memory transfer (software request only)</li><li>Access to Flash, SRAM, APB and AHB peripherals as source and destination</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="functional-description"></a>Functional description<a aria-hidden="true" tabindex="-1" class="hash-link" href="#functional-description" title="Direct link to heading">#</a></h2><p><img src="/img/products/w7500p/peripheral/dma_block_diagram.jpg" title="Figure 1 DMA block diagram"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="dma-request-mapping"></a>DMA request mapping<a aria-hidden="true" tabindex="-1" class="hash-link" href="#dma-request-mapping" title="Direct link to heading">#</a></h3><p>The hardware requests from the peripherals (UART0, UART1, SSP0, SSP1) are simply connected to the DMA. Refer to the below Table Summary of the DMA requests for each channel which lists the DMA requests for each channel.</p><table><thead><tr><th></th><th>Channel 1</th><th>Channel 2</th><th>Channel 3</th><th>Channel 4</th><th>Channel 5</th><th>Channel 6</th></tr></thead><tbody><tr><td>Hardware request</td><td>SSP0_TX <br> SSP0_RX</td><td>SSP1_TX <br> SSP1_RX</td><td>UART0_TX <br> UART0_RX</td><td>UART1_TX <br> UART1_RX</td><td>Channel 5</td><td>Channel 6</td></tr><tr><td>Software request</td><td>Support</td><td>Support</td><td>Support</td><td>Support</td><td>Support</td><td>Support</td></tr></tbody></table><ol><li>Software request is only way to use DMA for memory-to-memory or TCP/IP-to-memory.</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="dma-arbitration"></a>DMA arbitration<a aria-hidden="true" tabindex="-1" class="hash-link" href="#dma-arbitration" title="Direct link to heading">#</a></h3><p>The controller can be configured to perform arbitration during a DMA cycle before and after a programmable number of transfers. This reduces the latency for servicing a higher priority channel.
The controller uses four bits in the channel control data structure that configures how many AHB bus transfers occur before the controller re-arbitrates. These bits are known as the R_power bits because the value R is raised to the power of two and this determines the arbitration rate. For example, if R = 4, then the arbitration rate is 2^4, which means the controller arbitrates every 16 DMA transfers.</p><p><strong>Remark</strong>: Do not assign a low-priority channel with a large R_power value because this prevents the controller from servicing high-priority requests until it re-arbitrates.</p><p>When N &gt; 2<sup>R</sup> and is not an integer multiple of 2<sup>R</sup> then the controller always performs sequences of 2<sup>R</sup> transfers until N &lt; 2<sup>R</sup> remain to be transferred. The controller performs the remaining N transfers at the end of the DMA cycle.  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="dma-cycle-types"></a>DMA cycle types<a aria-hidden="true" tabindex="-1" class="hash-link" href="#dma-cycle-types" title="Direct link to heading">#</a></h3><p>The cycle_ctrl bits in the channel control data structure contril how the DMA controller performs a cycle.</p><p>The controller uses four cycle types described in this manual:</p><ul><li>Invalid</li><li>Basic</li><li>Auto-request</li><li>Ping-pong</li></ul><p>See ARM micro DMA (PL230) documentation for additional cycle types.</p><p>For all cycle types, the controller arbitrates after 2<sup>R</sup>  DMA transfers. If a low-priority channel is set to a large 2<sup>R</sup>  value then it prevents all other channels from performing a DMA transfer until the low-priority DMA transfer completes. Therefore, the user must be cautious when setting the R_power bit in the channel_cfg data structure so that the latency for high-priority channels is not significantly increased.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="invalid-cycle"></a>Invalid cycle<a aria-hidden="true" tabindex="-1" class="hash-link" href="#invalid-cycle" title="Direct link to heading">#</a></h4><p>After the controller completes a DMA cycle, it sets the cycle type to invalid to prevent it from repeating the same DMA cycle.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="basic-cycle"></a>Basic cycle<a aria-hidden="true" tabindex="-1" class="hash-link" href="#basic-cycle" title="Direct link to heading">#</a></h4><p>In this mode, the controller can be configured to use either the primary or the alternate channel control data structure. After the channel is enabled and the controller receives a request for this channel, the flow for basic cycle is as below:</p><ol><li>The controller performs 2<sup>R</sup>  transfers.
If the number of transfers remaining is zero the flow continues at step 3.</li><li>The controller arbitrates:<ul><li>If a higher-priority channel is requesting service, then the controller services that channel.</li><li>If the peripheral or software signals a request to the controller, then it continues at step 1.</li></ul></li><li>The controller sets dma_done[c] signal for this channel HIGH for one system clock cycle. This indicates to the host processor that the DMA cycle is complete.</li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="auto-request-cycle"></a>Auto request cycle<a aria-hidden="true" tabindex="-1" class="hash-link" href="#auto-request-cycle" title="Direct link to heading">#</a></h4><p>When the controller operates in this mode, it is only necessary to receive a single request to enable the controller to complete the entire DMA cycle. This enables a large data transfer to occur, without significantly increasing the latency for servicing higher priority requests or requiring multiple requests from the processor or peripheral.</p><p>The auto-request cycle is typically used for memory-to-memory requests. In this case, software generates the starting request for the 2^R transfers after setting up the DMA control data structure.</p><p>In this mode, the controller can be configured to use either the primary or the alternate channel control data structure. After the channel is enabled and the controller receives a request for this channel, the flow for the auto-request cycle is as below:</p><ol><li>The controller performs 2<sup>R</sup>  transfers. If the number of transfers remaining is zero the flow continues at step 3.</li><li>The controller arbitrates if there are any transfers remaining after 2<sup>R</sup>  transfers. If the current channel c has the highest priority, the cycle continues at step 1.</li><li>The controller sets dma_done[c] signal for this channel HIGH for one system clock cycle. This indicates to the host processor that the DMA cycle is complete.</li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="pingpong-cycle"></a>Pingpong cycle<a aria-hidden="true" tabindex="-1" class="hash-link" href="#pingpong-cycle" title="Direct link to heading">#</a></h4><p>In this mode, the controller performs a DMA cycle using one of the data structures and then performs a DMA cycle using the other data structure. The controller continues to switch between primary and alternate structures until it either reads a data structure that is invalid, or until the user reprograms the cycle_type to basic, or until the host processor disables the channel.</p><p>In ping-pong mode, the user can program or reprogram one of the two channel data structures (primary or alternate) while using the other channel data structure for the active transfer. When a transfer is done, the next transfer can be started immediately using the prepared channel data structure ‚Äì provided that a higher priority channel does not require servicing. If the user does not reprogram the channel control data structure not in use for a transfer, the cycle type remains invalid (which is the value at the end of the last transfer using that structure) and the ping-pong cycle completes.</p><p>The ping-pong cycle can be used for transfers to or from peripherals or for memory-to-memory transfers.</p><p><img src="/img/products/w7500p/peripheral/dma_ping_pong.jpg" title="Figure 2 DMA ping pong cycle"></p><hr></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/Wiznet/document_framework/tree/master/docs/Product/iMCU/W7500/Peripherals-internal/dma.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3klQ"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link">Introduction</a></li><li><a href="#features" class="table-of-contents__link">Features</a></li><li><a href="#functional-description" class="table-of-contents__link">Functional description</a><ul><li><a href="#dma-request-mapping" class="table-of-contents__link">DMA request mapping</a></li><li><a href="#dma-arbitration" class="table-of-contents__link">DMA arbitration</a></li><li><a href="#dma-cycle-types" class="table-of-contents__link">DMA cycle types</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction">Introduction</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://forum.wiznet.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">WIZnet Forum</a></li><li class="footer__item"><a href="http://maker.wiznet.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">WIZnet Maker</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/Wiznet/document_framework" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright ¬© 2020 WIZnet Co., Ltd. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.413cdf69.js"></script>
<script src="/runtime~main.f54b763e.js"></script>
<script src="/main.fba6c6f6.js"></script>
<script src="/1.171ba466.js"></script>
<script src="/2.b98f2df4.js"></script>
<script src="/3.18a04464.js"></script>
<script src="/1be78505.0d1935e2.js"></script>
<script src="/20ac7829.e3ea8621.js"></script>
<script src="/17896441.629849c2.js"></script>
<script src="/b235cbd4.120a16af.js"></script>
</body>
</html>